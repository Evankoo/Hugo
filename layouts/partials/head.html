<head>
  <meta charset="utf-8" />
  <title>
    {{ if (eq .Site.Params.reversepagetitle true) }}
      {{ with .Title }}
        {{ . }} |
      {{ end }}
      {{- .Site.Params.author -}}
    {{ else }}
      {{- .Site.Params.author -}}{{ with .Title }}
        |
        {{ . }}
      {{ end }}

    {{ end }}

  </title>

  <!-- Meta -->
  {{- hugo.Generator -}}
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="author" content="{{ .Site.Params.author }}" />

<meta
    name="description"
    content="{{ if .Params.description }}
      {{- .Params.description -}}
    {{ else }}
      {{- .Site.Params.description -}}
    {{ end }}"
  />

  {{ if .Params.redirectUrl }}
    <meta http-equiv="refresh" content="1; url={{ .Params.redirectUrl }}" />
  {{ end }}
  {{- if .Site.Params.googleSiteVerify }}
    <meta name="google-site-verification" content="{{ .Site.Params.googleSiteVerify }}" />
  {{- end -}}

<script>
(function () {
  var NIGHT_START = 19, DAY_START = 6;

  function isNightInBeijing(d) {
    d = d || new Date();
    var hourStr = new Intl.DateTimeFormat('zh-CN', {
      hour: '2-digit', hour12: false, timeZone: 'Asia/Shanghai'
    }).format(d);
    var h = parseInt(hourStr, 10);
    return h >= NIGHT_START || h < DAY_START;
  }

  function setTheme(t) {
    document.documentElement.setAttribute('data-theme', t);
    if (document.body) document.body.setAttribute('data-theme', t); // å…¼å®¹ä¸åŒä¸»é¢˜é€‰æ‹©å™¨
  }

  try {
    // è‹¥ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©è¿‡ä¸»é¢˜ï¼Œåˆ™å°Šé‡å®ƒï¼ˆå…¼å®¹å¸¸è§é”®åï¼‰
    var userPref = localStorage.getItem('theme') || localStorage.getItem('colorscheme');
    if (!userPref) setTheme(isNightInBeijing() ? 'dark' : 'light');
  } catch (e) {
    setTheme(isNightInBeijing() ? 'dark' : 'light');
  }

  // æ— æ‰‹åŠ¨è®¾ç½®æ—¶ï¼Œæ¯åˆ†é’Ÿæ ¡æ­£ä¸€æ¬¡
  setInterval(function () {
    try {
      var userPref = localStorage.getItem('theme') || localStorage.getItem('colorscheme');
      if (!userPref) setTheme(isNightInBeijing() ? 'dark' : 'light');
    } catch (e) {}
  }, 60 * 1000);
})();
</script>

  <!-- CSS -->
  {{ $contentRatio := or site.Params.contentratio 0.6 -}}
  {{ $languageDirection := or site.Language.LanguageDirection "ltr" -}}
  {{ $vars := dict
    "text_direction" $languageDirection
    "content_ratio" (printf "%f%%" (mul $contentRatio 100))
    "sidebar_ratio" (printf "%f%%" (mul (sub 1.0 $contentRatio) 100))
    "content_ratio_wide" (printf "%f%%" (mul 0.8 (mul $contentRatio 100)))
    "sidebar_ratio_wide" (printf "%f%%" (mul 0.8 (mul (sub 1.0 $contentRatio) 100)))
  -}}
  {{ $options := dict
    "transpiler" "dartsass"
    "vars" $vars
    "targetPath" (printf "css/anatole%s.css" (cond (eq site.Language.LanguageDirection "") "" (printf ".%s" site.Language.LanguageDirection)))
  -}}
  {{ with resources.Get "scss/main.scss" -}}
    {{ if hugo.IsProduction -}}
      {{ with . | toCSS $options | minify | fingerprint }}
        <link rel="stylesheet" href="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous" />
      {{ end -}}
    {{ else -}}
      {{ with . | toCSS $options }}
        <link rel="stylesheet" href="{{ .RelPermalink }}" />
      {{ end -}}
    {{ end -}}
  {{ end -}}

<!-- âš¡ï¸ FontAwesome CDN ä¼˜åŒ–ï¼šç›´æ¥å¼•ç”¨å…¬å…±åº“ï¼Œé€Ÿåº¦å¿«ä¸”ä¸ä¸¢å›¾æ ‡ -->
  <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">

  {{/* è‡ªå®šä¹‰æ ·å¼ï¼ˆæ”¾æœ€åï¼Œæ–¹ä¾¿è¦†ç›–ï¼‰ */}}
  {{ $custom := resources.Get "scss/custom.scss" | toCSS (dict "transpiler" "dartsass") }}
  {{ if hugo.IsProduction }}
    {{ $custom = $custom | minify | fingerprint }}
    <link rel="stylesheet" href="{{ $custom.RelPermalink }}" integrity="{{ $custom.Data.Integrity }}" crossorigin="anonymous">
  {{ else }}
    <link rel="stylesheet" href="{{ $custom.RelPermalink }}">
  {{ end }}

{{ if .Params.redirectUrl }}
    {{ $style := resources.Get "css/spinner.css" | resources.Minify | resources.Fingerprint }}
    <link
      rel="stylesheet"
      href="{{ $style.RelPermalink }}"
      integrity="{{ $style.Data.Integrity }}"
      crossorigin="anonymous"
      type="text/css"
    />
  {{- end -}}
  {{ if .Site.Params.googleFonts }}
    {{ $baseUrl := "https://fonts.googleapis.com/css2?family=" }}
    {{ $fontParam := delimit .Site.Params.googleFonts "&family=" }}
    {{ $url := printf "%s" "&display=swap" | printf "%s%s" $fontParam | printf "%s%s" $baseUrl | printf "%s" }}
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="{{ $url }}" rel="stylesheet" />
  {{- end -}}


  <!-- Favicons -->
  <link rel="shortcut icon" href="{{ .Site.Params.favicon | relURL }}favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="{{ .Site.Params.favicon | relURL }}apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="{{ .Site.Params.favicon | relURL }}favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="{{ .Site.Params.favicon | relURL }}favicon-16x16.png" />

  <link rel="canonical" href="{{ .Permalink }}" />
  <!-- License -->
  {{- with .Site.Params.license -}}
    <link rel="license" href="{{ . }}" />
  {{- end -}}


  <!-- RSS -->
  {{ with .OutputFormats.Get "rss" -}}
    {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .RelPermalink $.Site.Title | safeHTML }}
  {{ end -}}


  <!-- JavaScript -->
  {{ $anatoleHeader := resources.Get "js/anatole-header.js" }}
  {{ $secureHeaderJS := $anatoleHeader |  resources.Minify | resources.Fingerprint }}
  <script
    type="text/javascript"
    src="{{ $secureHeaderJS.RelPermalink }}"
    integrity="{{ $secureHeaderJS.Data.Integrity }}"
    crossorigin="anonymous"
  ></script>

  {{ $animatedJS := resources.Get "js/main-animated.js" | resources.Minify | resources.Fingerprint }}
  <script
    type="text/javascript"
    src="{{ $animatedJS.RelPermalink }}"
    integrity="{{ $animatedJS.Data.Integrity }}"
    crossorigin="anonymous"
    defer
  ></script>

  {{ if not .Site.Params.disableThemeSwitcher }}
    {{ $anatoleThemeSwitcher := resources.Get "js/anatole-theme-switcher.js" }}
    {{ $secureThemeSwitcherJS := $anatoleThemeSwitcher |  resources.Minify | resources.Fingerprint }}
    <script
      type="text/javascript"
      src="{{ $secureThemeSwitcherJS.RelPermalink }}"
      integrity="{{ $secureThemeSwitcherJS.Data.Integrity }}"
      crossorigin="anonymous"
    ></script>
  {{ end }}

  {{- $js := "" -}}
  {{- range .Site.Params.customJs -}}
    {{- if or (in . "http://") (in . "https://") -}}
      <script src="{{ . | relURL }}"></script>
    {{- else -}}
      {{- $customJS := resources.Get . -}}
      {{- if $customJS -}}
        {{- if eq $js "" -}}
          {{- $js = $customJS -}}
        {{- else -}}
          {{- $js = slice $js $customJS | resources.Concat "js/custom.js" -}}
        {{- end -}}

      {{- end -}}

    {{- end -}}

  {{- end -}}

  {{- if ne $js "" -}}
    {{- $secureJS := $js |  resources.Minify | resources.Fingerprint -}}
    <script
      type="text/javascript"
      src="{{ $secureJS.RelPermalink }}"
      integrity="{{ $secureJS.Data.Integrity }}"
      crossorigin="anonymous"
    ></script>
  {{- end -}}

  {{ if and hugo.IsProduction .Site.Params.plausibleAnalytics .Site.Params.plausibleAnalytics.domain }}
    {{- partial "analytics/plausible" . -}}
  {{ end }}

  {{ if and hugo.IsProduction .Site.Params.umami.serverURL .Site.Params.umami.id }}
    {{- partial "analytics/umami" . -}}
  {{ end }}

  {{ if and hugo.IsProduction .Site.Params.Matomo.instance .Site.Params.Matomo.siteId }}
    {{- partial "analytics/matomo" . -}}
  {{ end }}

  {{ if and hugo.IsProduction .Site.Params.meta.pixelId }}
    {{- partial "analytics/meta.html" . -}}
  {{ end }}


  <!-- Twitter Cards -->
  {{ template "_internal/twitter_cards.html" . }}


  <!-- Open Graph -->
  {{ template "_internal/opengraph.html" . }}


  <!-- Schema.org-->
  {{ partial "schema.html" . }}


  <!-- KaTeX-->
  {{ $noop := .WordCount }}
  {{ if .Page.Store.Get "hasMath" }}
    {{ $katex_css_url := printf "https://cdn.jsdelivr.net/npm/katex@latest/dist/katex%s.css" (cond hugo.IsProduction ".min" "") -}}
    {{ with try (resources.GetRemote $katex_css_url) -}}
      {{ with .Err -}}
        {{ errorf "Could not retrieve KaTeX css file from CDN. Reason: %s." . -}}
      {{ else with.Value -}}
        {{ with resources.Copy (printf "css/katex%s.css" (cond hugo.IsProduction ".min" "")) . }}
          {{ $secureCSS := . | resources.Fingerprint "sha512" -}}
          <link
            rel="stylesheet"
            href="{{- .RelPermalink -}}"
            integrity="{{- $secureCSS.Data.Integrity -}}"
            crossorigin="anonymous"
          />
        {{ end -}}
      {{ end -}}
    {{ end -}}
  {{ end }}

<!-- ğŸš€ ç§»åŠ¨ç«¯é¦–é¡µæ ·å¼å¼ºåˆ¶ä¿®å¤ -->
<style>
/* ä»…åœ¨ç§»åŠ¨ç«¯ç”Ÿæ•ˆ */
@media screen and (max-width: 768px) {
  /* 1. é¦–é¡µæ–‡ç« å¡ç‰‡ï¼šå¤§å¹…å‡å°é—´è· */
  body.home .post {
    margin-bottom: 20px !important;
    padding-bottom: 15px !important;
    border-bottom: 1px dashed #eee !important;
  }

  /* 2. å›¾ç‰‡å®¹å™¨ï¼šé™åˆ¶é«˜åº¦ */
  body.home .post .post__thumbnail-wrapper {
    margin-top: 5px !important;
    margin-bottom: 8px !important;
    height: 160px !important;
    max-height: 160px !important;
    border-radius: 6px !important;
    overflow: hidden !important;
  }

  /* 3. å›¾ç‰‡æœ¬èº«ï¼šå¼ºåˆ¶å¡«æ»¡ */
  body.home .post .post__thumbnail-wrapper img {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    display: block !important;
  }

  /* 4. æ ‡é¢˜ï¼šç¼©å° */
  body.home .post .post__title {
    font-size: 18px !important;
    margin: 5px 0 !important;
    line-height: 1.3 !important;
  }

  /* 5. æ‘˜è¦ï¼šç´§å‡‘ */
  body.home .post .post__content p {
    margin: 0 0 8px 0 !important;
    font-size: 13px !important;
    line-height: 1.5 !important;
    color: #666 !important;
    
    /* å¼ºåˆ¶æ˜¾ç¤º2è¡Œ */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* 6. åº•éƒ¨ä¿¡æ¯ï¼šç´§å‡‘ */
  body.home .post .post__footer {
    margin-top: 0 !important;
    padding: 0 !important;
  }
}
</style>
</head>
