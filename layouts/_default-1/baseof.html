<!doctype html>
<html
  dir="{{ .Site.Language.LanguageDirection | default "ltr" }}"
  lang="{{- site.Language.Lang -}}"
  data-theme="{{- .Site.Params.displayMode -}}"
  {{ if eq .Site.Params.displayMode "dark" }}
    class="html theme--dark"
  {{ else }}
    class="html theme--light"
  {{ end }}
>
  {{- partial "head.html" . -}}
<body
  class='body{{ if .IsHome }} home{{ end }} kind-{{ .Kind }}{{ with .Section }} section-{{ . }}{{ end }}{{ with .Type }} type-{{ . }}{{ end }}'
  data-kind='{{ .Kind }}'
  data-section='{{ .Section }}'
  data-type='{{ .Type }}'
>
    <div class="wrapper">
      <aside
        {{ if (and (or (eq .Site.Params.hidesidebar true) (eq .Params.hidesidebar true)) (not .IsHome)) }}
          class="wrapper__sidebar wrapper__sidebar--hidden"
        {{ else }}
          class="wrapper__sidebar"
        {{ end }}
      >
        {{- partial "sidebar.html" . -}}
      </aside>
      <main
        {{ if (and (or (eq .Site.Params.hidesidebar true) (eq .Params.hidesidebar true)) (not .IsHome)) }}
          class="wrapper__main wrapper__main--fullscreen"
        {{ else }}
          class="wrapper__main"
        {{ end }}
      >
        <header class="header">{{ partial "navbar.html" . }}</header>
        {{- block "main" . }}{{- end }}
      </main>
    </div>

    {{- partial "footer.html" (dict "context" . "footerClassModifier" "base") -}}

    {{- if (eq .Site.Params.simpleAnalytics.enable true) -}}
      {{- partial "analytics/simpleanalytics.html" . -}}
    {{- end -}}

{{/* ⚡️ Mermaid 优化版：只有在 config 开启且文章头部声明 mermaid: true 时才加载 */}}
    {{ if and .Site.Params.mermaidEnable .Params.mermaid }}
      <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js" crossorigin="anonymous"></script>
      <script>
        // 检测暗色模式，自动切换 Mermaid 主题
        const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default';
        mermaid.initialize({ startOnLoad: true, theme: theme });
      </script>
    {{ end }}

  </body>
</html>
